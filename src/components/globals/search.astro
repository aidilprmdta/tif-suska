<!-- ---
const placeholder = "Cari halaman...";
---

<div class="w-full max-w-xl mx-auto mt-10 relative">
  <input
    id="searchBox"
    type="text"
    placeholder={placeholder}
    class="w-full px-4 py-2 rounded-lg border bg-white shadow"
  />

  <div
    id="results"
    class="hidden absolute z-50 w-full mt-2 bg-white shadow-lg rounded-lg max-h-64 overflow-auto"
  ></div>
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const box = document.getElementById("searchBox");
    const results = document.getElementById("results");

    let data = [];

    fetch("/api/search")
      .then(res => res.json())
      .then(json => data = json);

    function debounce(fn, delay = 300) {
      let timer;
      return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => fn(...args), delay);
      };
    }

    function highlight(text, keyword) {
      if (!keyword) return text;
      const escaped = keyword.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      return text.replace(
        new RegExp(`(${escaped})`, "gi"),
        `<mark class="bg-yellow-200">$1</mark>`
      );
    }

    const handleSearch = debounce(() => {
      const q = box.value.toLowerCase().trim();

      if (!q) {
        results.classList.add("hidden");
        results.innerHTML = "";
        return;
      }

      const filtered = data.filter(
        item =>
          item.title.toLowerCase().includes(q) ||
          item.text.toLowerCase().includes(q)
      );

      if (!filtered.length) {
        results.innerHTML =
          `<div class="px-4 py-2 text-gray-500">Tidak ada hasil</div>`;
        results.classList.remove("hidden");
        return;
      }

      results.innerHTML = filtered.slice(0, 10).map(item => `
        <a href="${item.path}" class="block px-4 py-2 hover:bg-gray-100">
          <div class="font-semibold">
            ${highlight(item.title, q)}
          </div>
          <p class="text-sm text-gray-600">
            ${highlight(item.text.slice(0, 100), q)}...
          </p>
        </a>
      `).join("");

      results.classList.remove("hidden");
    }, 300);

    box.addEventListener("input", handleSearch);
  });
</script> -->
